description: >
  Run Maven compile with dependency caching. Caches ~/.m2/repository
  using pom.xml checksum to accelerate subsequent builds. Uses the CI
  settings.xml generated by setup_maven_settings.
parameters:
  maven_args:
    type: string
    default: ""
    description: Extra Maven arguments passed to the compile phase.
steps:
  - restore_cache:
      keys:
        - mvn-deps-v1-{{ checksum "pom.xml" }}
        - mvn-deps-v1-
  - run:
      name: Maven compile
      environment:
        PARAM_MAVEN_ARGS: << parameters.maven_args >>
      command: << include(scripts/mvn_build_compile.sh) >>
  - save_cache:
      key: mvn-deps-v1-{{ checksum "pom.xml" }}
      paths:
        - ~/.m2/repository
